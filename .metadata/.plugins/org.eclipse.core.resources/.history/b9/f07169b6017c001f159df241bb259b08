package Procesos;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.PrintWriter;

public class guardarSVCHOST {
	
	public static void main(String[] args) throws FileNotFoundException {
		 try (FileOutputStream fos = new FileOutputStream(args[0]);
	             PrintWriter pw = new PrintWriter(fos)) {

	            // Ejecutar el comando
	            Runtime r = Runtime.getRuntime();
	            String comando = "tasklist /svc /fi \"imagename eq svchost.exe\"";
	            String linea;
	            Process p;

	            try {
	                p = r.exec(comando);
	                InputStream salidaComando = p.getInputStream();
	                BufferedReader buffer = new BufferedReader(new InputStreamReader(salidaComando));

	                // Leer la salida del comando
	                while ((linea = buffer.readLine()) != null) {
	                    System.out.println("INSERTO EN " + args[0] + " > " + linea);
	                    pw.println(linea);  // Escribir en el archivo
	                }

	                // Cerrar el buffer
	                buffer.close();

	            } catch (IOException e) {
	                System.out.println("Error en " + comando);
	                e.printStackTrace();
	            }

	            // Obtener el c√≥digo de salida del proceso
	            int exitVal;
	            try {
	                exitVal = p.waitFor();
	                System.out.println("Valor de Salida: " + exitVal);
	            } catch (InterruptedException e) {
	                e.printStackTrace();
	            }

	        } catch (FileNotFoundException e) {
	            System.out.println("No se pudo encontrar o crear el archivo: " + args[0]);
	            e.printStackTrace();
	        } catch (IOException e) {
	            System.out.println("Error al cerrar el archivo.");
	            e.printStackTrace();
	        }
	    }
	}